'use client';
import { useEffect, useState, useRef } from 'react';
import { auth, db } from './lib/firebase';
import { onAuthStateChanged } from 'firebase/auth';
import { collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from 'firebase/firestore';
export default function Chat(){const [user,setUser]=useState(null);const [text,setText]=useState('');const [msgs,setMsgs]=useState([]);const boxRef=useRef();useEffect(()=>onAuthStateChanged(auth,u=>setUser(u)),[]);useEffect(()=>{const q=query(collection(db,'chats'),orderBy('createdAt','asc'));const unsub=onSnapshot(q,snap=>{setMsgs(snap.docs.map(d=>({id:d.id,...d.data()})));if(boxRef.current)boxRef.current.scrollTop=boxRef.current.scrollHeight;});return ()=>unsub();},[]);async function send(){if(!user) return alert('Please login'); if(!text.trim()) return; await addDoc(collection(db,'chats'),{uid:user.uid,name:user.displayName||user.email,text,createdAt:serverTimestamp()});setText('');}return (<div style={{maxWidth:720,margin:'0 auto'}}><h2>Chat With Us</h2><div className="card" style={{padding:0}}><div className="chat-header">Chat â€” Brightika Assistant</div><div className="chat-body" ref={boxRef}>{msgs.map(m=>(<div key={m.id} style={{marginBottom:8}}><div style={{fontSize:12,color:'#64748b'}}>{m.name}</div><div>{m.text}</div></div>))}</div><div className="chat-input"><input value={text} onChange={e=>setText(e.target.value)} placeholder="Type message..." className="w-full" /><button className="btn-primary" onClick={send}>Send</button></div></div><div style={{marginTop:8}}><a className="btn-ghost" href={process.env.NEXT_PUBLIC_WHATSAPP_LINK} target="_blank" rel="noreferrer">Chat on WhatsApp</a></div></div>);}
